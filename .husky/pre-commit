# Load nvm if available
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Use .nvmrc if present
if [ -f .nvmrc ]; then
  nvm use 2>/dev/null || true
fi

# Try to enable corepack if available
if command -v corepack >/dev/null 2>&1; then
  corepack enable 2>/dev/null || true
fi

# Check if pnpm is available, fail in CI if missing, warn and skip locally
if command -v pnpm >/dev/null 2>&1; then
  pnpm run format
  pnpm run lint
  pnpm run typecheck
else
  if [ "$CI" = "true" ]; then
    echo "ERROR: pnpm not found in CI environment. Please ensure pnpm is installed (e.g., via corepack enable)."
    exit 1
  else
    echo "WARNING: pnpm not found, skipping pre-commit hooks. Please install pnpm (see packageManager in package.json)."
    exit 0
  fi
fi

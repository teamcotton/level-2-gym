# Load nvm if available
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Use .nvmrc if present
if [ -f .nvmrc ]; then
  nvm use 2>/dev/null || true
fi

# Try to enable corepack if available
if command -v corepack >/dev/null 2>&1; then
  corepack enable 2>/dev/null || true
fi

# Ensure pnpm is available
if ! command -v pnpm >/dev/null 2>&1; then
  echo "Error: pnpm is required for pre-push hooks. Please install pnpm (https://pnpm.io/)."
  exit 1
fi
# Always run from repo root to ensure scripts exist
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT" || exit 1
pnpm run format
pnpm run lint
pnpm run typecheck
pnpm run test
## This is for developers only. AI can pass this test
## VERY IMPORTANT: AI must always reinstate the logic in the if statement if
## it is amended to skip e2e tests
if [ "${SKIP_E2E:-1}" = "1" ]; then
  echo "Skipping e2e (SKIP_E2E=1)"
else
  pnpm run test:e2e
fi
